#!/usr/bin/env ruby
REPOS = [
  {
    url: 'https://github.com/sorin-ionescu/prezto.git',
    dir: '~/.zprezto',
    submodules: true
  },
  # version managers
  {
    url: 'https://github.com/creationix/nvm.git',
    dir: '~/.nvm',
    submodules: false
  },
  {
    url: 'https://github.com/sstephenson/rbenv.git',
    dir: '~/.rbenv'
  },
  {
    url: 'https://github.com/yyuu/pyenv.git',
    dir: '~/.pyenv',
    submodules: false
  },
  # plugins
  {
    url: 'https://github.com/sstephenson/ruby-build.git',
    dir: '~/.rbenv/plugins/ruby-build',
    submodules: false
  }
]

threads = REPOS.map do |r|
  Thread.new do
    path = File.expand_path(r[:dir])

    if File.directory?(path)
      puts "Updating \"#{path}\""
      `(cd #{path} && git pull #{'&& git submodule update --init --recursive' if r[:submodules]})`
    else
      puts "Installing \"#{path}\""
      `git clone #{'--recursive' if r[:submodules]} #{r[:url]} #{path}`
    end
  end
end

threads.each(&:join)

Dir[File.expand_path('~/.zprezto/runcoms/z*')].each do |f|
  target = "~/.#{File.basename(f)}"
  puts "Symlinking \"#{f}\" into \"#{target}\""
  `ln -sf #{f} #{target}`
end
